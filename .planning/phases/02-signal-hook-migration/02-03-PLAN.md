---
phase: 02-signal-hook-migration
plan: 03
type: execute
wave: 2
depends_on: [02-01, 02-02]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "All Phase 2 requirements verified complete"
    - "No zsh trap/hook syntax remains"
    - "PROMPT_COMMAND hooks work together"
  artifacts: []
  key_links:
    - from: "core/history.sh"
      to: "features/broadcast.sh"
      via: "PROMPT_COMMAND chaining"
      pattern: "PROMPT_COMMAND.*;"
---

<objective>
Verify Phase 2 signal and hook migration is complete

Purpose: Gate check before Phase 3 - confirm all SIG-* and HOOK-* requirements satisfied
Output: Verified Phase 2 completion, updated STATE.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@features/broadcast.sh
@core/history.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify signal and hook requirements</name>
  <files></files>
  <action>
Run verification checks for all Phase 2 requirements:

**SIG-01: TRAPUSR1 -> trap '...' USR1**
```bash
grep -q "^trap.*USR1" features/broadcast.sh && echo "SIG-01: PASS" || echo "SIG-01: FAIL"
```

**SIG-02: TRAPEXIT -> trap '...' EXIT**
```bash
grep -q "trap.*EXIT" features/broadcast.sh && echo "SIG-02: PASS" || echo "SIG-02: FAIL"
```

**SIG-03: Broadcast system works with bash traps**
```bash
# Verify zbc function sends USR1
grep -q "pkill -USR1" features/broadcast.sh && echo "SIG-03: PASS" || echo "SIG-03: FAIL"
```

**HOOK-01: precmd -> PROMPT_COMMAND**
```bash
# Both files should use PROMPT_COMMAND
grep -q "PROMPT_COMMAND" features/broadcast.sh && \
grep -q "PROMPT_COMMAND" core/history.sh && echo "HOOK-01: PASS" || echo "HOOK-01: FAIL"
```

**HOOK-02 & HOOK-03**: Already verified in Phase 1 (prompt.sh uses bash PS1)

**No zsh constructs remain**:
```bash
! grep -q "TRAPUSR1\|TRAPEXIT\|precmd()" features/broadcast.sh core/history.sh && \
echo "ZSH-FREE: PASS" || echo "ZSH-FREE: FAIL"
```

**Syntax validation**:
```bash
bash -n features/broadcast.sh && bash -n core/history.sh && echo "SYNTAX: PASS" || echo "SYNTAX: FAIL"
```
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>Verification task - no code to test, only validation of prior work</skip_tests_reason>
  </tests>
  <verify>
    All checks output PASS
  </verify>
  <done>
    - SIG-01, SIG-02, SIG-03 verified
    - HOOK-01, HOOK-02, HOOK-03 verified
    - No zsh trap/hook constructs in modified files
    - Both files pass bash -n
  </done>
</task>

<task type="auto">
  <name>Task 2: Update project state</name>
  <files>.planning/STATE.md</files>
  <action>
Update STATE.md to reflect Phase 2 completion:

1. Update "Current Phase" to show Phase 2 complete
2. Update Progress table: Phase 2 row should show "Complete"
3. Add decision entry: "phase2-verified" with rationale about signal/hook migration
4. Update Session Continuity section with current date and "Next: Begin Phase 3"

Also update REQUIREMENTS.md to mark completed:
- [x] SIG-01, SIG-02, SIG-03
- [x] HOOK-01, HOOK-02, HOOK-03
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>Documentation update - no code to test</skip_tests_reason>
  </tests>
  <verify>
    grep -q "Phase 2.*Complete" .planning/STATE.md
    grep -q "\[x\] \*\*SIG-01\*\*" .planning/REQUIREMENTS.md
  </verify>
  <done>
    - STATE.md shows Phase 2 complete
    - REQUIREMENTS.md has SIG-* and HOOK-* checked
    - Ready for Phase 3
  </done>
</task>

</tasks>

<verification>
cat .planning/STATE.md | grep -A5 "Progress"
grep "SIG-\|HOOK-" .planning/REQUIREMENTS.md
</verification>

<success_criteria>
1. All SIG-* requirements verified and checked in REQUIREMENTS.md
2. All HOOK-* requirements verified and checked in REQUIREMENTS.md
3. STATE.md updated to show Phase 2 complete
4. No zsh trap/hook syntax in any .sh files
5. Ready for Phase 3 (Installer Update)
</success_criteria>

<output>
After completion, create `.planning/phases/02-signal-hook-migration/02-03-SUMMARY.md`
</output>
