---
phase: 03-installer-update
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [install.sh]
autonomous: true

must_haves:
  truths:
    - "install.sh does not attempt to install zsh"
    - "install.sh does not change user's default shell"
    - "install.sh links ~/.bashrc to bashrc"
    - "install.sh creates ~/.bash_broadcasts directory"
    - "install.sh final exec is bash, not zsh"
  artifacts:
    - path: "install.sh"
      provides: "Bash-configured installer"
      contains: "exec bash"
  key_links:
    - from: "install.sh"
      to: "bashrc"
      via: "symlink creation"
      pattern: 'ln -s.*bashrc.*\.bashrc'
---

<objective>
Convert install.sh to configure bash instead of zsh.

Purpose: Complete the bash migration by ensuring new installations use bash
Output: Modified install.sh that installs bash configuration
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-installer-update/03-CONTEXT.md
@install.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove zsh installation and convert to bash configuration</name>
  <files>install.sh</files>
  <action>
Modify install.sh with the following changes (line numbers reference current file):

1. **Line 4** - Update header comment:
   - FROM: "Installs and configures the modular ZSH shell system"
   - TO: "Installs and configures the modular bash shell system"

2. **Lines 39-61** - DELETE entire zsh installation/check section:
   - Remove the `if ! has_command zsh` block entirely
   - Remove the package manager detection for zsh
   - Remove "ZSH found" / "ZSH installed" messages
   - bash is always available, no installation needed

3. **Line 160** - Update history import check:
   - FROM: `if [[ -f "$HOME/.zsh_history" ]]`
   - TO: `if [[ -f "$HOME/.bash_history" ]]`

4. **Lines 218-223** - Update config backup:
   - FROM: Check and backup `.zshrc` to `.zshrc.backup`
   - TO: Check and backup `.bashrc` to `.bashrc.backup`

5. **Lines 235-239** - Update symlink creation:
   - FROM: `ln -s "$SHELL_DIR/zshrc" "$HOME/.zshrc"`
   - TO: `ln -s "$SHELL_DIR/bashrc" "$HOME/.bashrc"`
   - Update info message and success message to reference bashrc

6. **Line 243** - Update broadcast directory:
   - FROM: `mkdir -p "$HOME/.zsh_broadcasts"`
   - TO: `mkdir -p "$HOME/.bash_broadcasts"`

7. **Lines 253-272** - Update work secrets template:
   - Change filename from `work.zsh` to `work.sh`
   - Change shebang from `#!/bin/zsh` to `#!/bin/bash`
   - Update info message to reference `work.sh`

8. **Lines 275-290** - DELETE entire chsh section:
   - Remove the `if [[ "$SHELL" != *"zsh"* ]]` block entirely
   - We do not change user's default shell

9. **Lines 301, 308** - Update final messages and exec:
   - FROM: "Starting ZSH with your new configuration..."
   - TO: "Starting bash with your new configuration..."
   - FROM: `exec zsh -c "source ~/.zshrc; exec zsh"`
   - TO: `exec bash -c "source ~/.bashrc; exec bash"`
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>Installer is a bash script - verified by bash -n syntax check in Task 2</skip_tests_reason>
  </tests>
  <verify>
File modified with all substitutions complete:
- `grep -c "zsh" install.sh` returns 0 (no zsh references)
- `grep -c "bashrc" install.sh` returns non-zero
- `grep "exec bash" install.sh` shows final exec
  </verify>
  <done>
All zsh references removed from install.sh:
- No zsh installation step
- No chsh call
- Links ~/.bashrc to bashrc
- Creates ~/.bash_broadcasts
- Work template is work.sh with bash shebang
- Final exec is bash
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify installer syntax and requirements</name>
  <files>install.sh</files>
  <action>
Verify the modified install.sh:

1. Run `bash -n install.sh` to check for syntax errors
2. Verify no zsh references remain: `grep -i "zsh" install.sh` should return nothing
3. Verify bash references present:
   - `grep "bashrc" install.sh` shows symlink line
   - `grep "bash_broadcasts" install.sh` shows mkdir line
   - `grep "exec bash" install.sh` shows final exec
4. Verify requirements coverage:
   - INS-01: No zsh installation code (no apt-get/yum install zsh)
   - INS-02: Links ~/.bashrc (not ~/.zshrc)
   - INS-03: No chsh call
   - INS-04: No zsh installation step
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>This task IS the verification - bash -n provides syntax validation</skip_tests_reason>
  </tests>
  <verify>
All verification commands pass:
- `bash -n install.sh` exits 0
- `grep -i "zsh" install.sh` returns empty (exit 1)
- `grep "bashrc" install.sh` returns matches
- `grep "bash_broadcasts" install.sh` returns matches
- `grep "exec bash" install.sh` returns match
- `grep "chsh" install.sh` returns empty (exit 1)
  </verify>
  <done>
install.sh passes syntax check and contains no zsh references.
All INS-* requirements satisfied.
  </done>
</task>

</tasks>

<verification>
Phase 3 requirements verified:
- INS-01: Installer configures bash (no zsh installation code)
- INS-02: Links ~/.bashrc (symlink to bashrc)
- INS-03: Does not change default shell (no chsh)
- INS-04: Removes zsh installation step (section deleted)
</verification>

<success_criteria>
1. `bash -n install.sh` passes with no errors
2. `grep -i "zsh" install.sh` returns nothing
3. `grep "ln -s.*bashrc" install.sh` shows correct symlink
4. `grep "mkdir.*bash_broadcasts" install.sh` shows correct directory
5. `grep "exec bash" install.sh` shows correct final command
6. No chsh reference remains
</success_criteria>

<output>
After completion, create `.planning/phases/03-installer-update/03-01-SUMMARY.md`
</output>
