---
phase: 01-core-syntax-conversion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bashrc
  - core/environment.sh
  - core/options.sh
  - core/history.sh
  - interactive/colors.sh
  - interactive/aliases.sh
  - interactive/prompt.sh
  - logging/replay-tools.sh
  - logging/session-tracker.sh
  - tools/nvm.sh
  - tools/system.sh
autonomous: true

must_haves:
  truths:
    - "All core and simple files renamed from .zsh to .sh"
    - "bashrc exists and sources .sh files"
    - "setopt calls converted to shopt equivalents"
    - "[[ -o interactive ]] converted to [[ $- == *i* ]]"
    - "PS1 uses bash format instead of zsh format"
  artifacts:
    - path: "bashrc"
      provides: "Main entry point for bash"
      contains: "#!/bin/bash"
    - path: "core/options.sh"
      provides: "Shell options via shopt"
      contains: "shopt"
    - path: "core/history.sh"
      provides: "History configuration"
      contains: "HISTCONTROL"
  key_links:
    - from: "bashrc"
      to: "core/*.sh"
      via: "source_module calls"
      pattern: 'source_module "core/'
---

<objective>
Convert core files and entry point from zsh to bash syntax.

Purpose: Establish the foundation - bashrc and core modules working in bash.
Output: 11 renamed/converted files with bash syntax.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename and convert core files</name>
  <files>
    core/environment.sh
    core/options.sh
    core/history.sh
  </files>
  <action>
For each file in core/*.zsh:

1. **core/environment.zsh -> core/environment.sh**
   - Change shebang: `#!/bin/zsh` -> `#!/bin/bash`
   - File is already bash-compatible, no other changes needed

2. **core/options.zsh -> core/options.sh**
   - Change shebang: `#!/bin/zsh` -> `#!/bin/bash`
   - Convert setopt/unsetopt to shopt:
     - `setopt autocd` -> `shopt -s autocd`
     - `setopt extendedglob` -> REMOVE (bash extglob is less useful, skip)
     - `setopt interactivecomments` -> enabled by default in bash, REMOVE
     - `setopt ignoreeof` -> `set -o ignoreeof`
     - `setopt CORRECT_ALL` -> REMOVE (this is the y/n prompt we hate)
     - `unsetopt beep` -> `bind 'set bell-style none'` (or skip, low priority)
   - Keep `set -o vi`

3. **core/history.zsh -> core/history.sh**
   - Change shebang: `#!/bin/zsh` -> `#!/bin/bash`
   - Change `~/.zsh_history` -> `~/.bash_history`
   - Convert setopt to bash equivalents:
     - `setopt HIST_IGNORE_DUPS` -> `HISTCONTROL=ignoredups`
     - `setopt HIST_IGNORE_SPACE` -> `HISTCONTROL=ignoreboth` (combines dups+space)
     - `setopt APPEND_HISTORY` -> `shopt -s histappend`
     - `setopt INC_APPEND_HISTORY` -> `PROMPT_COMMAND="history -a"` (defer to Phase 2)
     - `setopt SHARE_HISTORY` -> remove (complex in bash, not needed)
     - `setopt HIST_REDUCE_BLANKS` -> remove (bash doesn't have this)
   - Change `return` to `return 0` (bash prefers explicit)

Do NOT delete the original .zsh files yet - git mv will handle rename.
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>Configuration files - verified by bash -n in Task 3</skip_tests_reason>
  </tests>
  <verify>
    bash -n core/environment.sh && bash -n core/options.sh && bash -n core/history.sh
  </verify>
  <done>Three core/*.sh files exist with bash syntax, pass bash -n</done>
</task>

<task type="auto">
  <name>Task 2: Convert interactive and logging files</name>
  <files>
    interactive/colors.sh
    interactive/aliases.sh
    interactive/prompt.sh
    logging/replay-tools.sh
    logging/session-tracker.sh
    tools/nvm.sh
    tools/system.sh
  </files>
  <action>
For each file:

1. **interactive/colors.zsh -> interactive/colors.sh**
   - Change shebang
   - `[[ ! -o interactive ]]` -> `[[ $- != *i* ]]`

2. **interactive/aliases.zsh -> interactive/aliases.sh**
   - Change shebang
   - Change `~/.zsh_aliases` -> `~/.bash_aliases`
   - Rest is already bash-compatible

3. **interactive/prompt.zsh -> interactive/prompt.sh**
   - Change shebang
   - `[[ ! -o interactive ]]` -> `[[ $- != *i* ]]`
   - Convert PS1 from zsh format to bash format:
     - `%B%F{green}%n@%m%f:%B%F{blue}%~%f%b$` becomes:
     - `\[\033[1;32m\]\u@\h\[\033[0m\]:\[\033[1;34m\]\w\[\033[0m\]$ `
     (Bold green user@host, reset, colon, bold blue path, reset, dollar space)

4. **logging/replay-tools.zsh -> logging/replay-tools.sh**
   - Change shebang
   - Already bash-compatible (uses standard shell constructs)

5. **logging/session-tracker.zsh -> logging/session-tracker.sh**
   - Change shebang
   - `[[ ! -o interactive ]]` -> `[[ $- != *i* ]]`
   - Change final exec line: `zsh -l` -> `bash -l`

6. **tools/nvm.zsh -> tools/nvm.sh**
   - Change shebang
   - Change `zsh_completion` -> `bash_completion` reference

7. **tools/system.zsh -> tools/system.sh**
   - Change shebang
   - `[[ ! -o interactive ]]` -> `[[ $- != *i* ]]`
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>Configuration files - verified by bash -n</skip_tests_reason>
  </tests>
  <verify>
    for f in interactive/colors.sh interactive/aliases.sh interactive/prompt.sh logging/replay-tools.sh logging/session-tracker.sh tools/nvm.sh tools/system.sh; do bash -n "$f" || exit 1; done
  </verify>
  <done>Seven files converted, all pass bash -n</done>
</task>

<task type="auto">
  <name>Task 3: Create bashrc from zshrc</name>
  <files>bashrc</files>
  <action>
Create bashrc based on zshrc with these changes:

1. Change shebang: `#!/bin/zsh` -> `#!/bin/bash`
2. Update header comment: "Modular ZSH Configuration" -> "Modular Bash Configuration"
3. In source_module function:
   - `[[ -f "$THOMCOM_SHELL_ROOT/$1" ]]` -> same (bash-compatible)
4. All `[[ -o interactive ]]` -> `[[ $- == *i* ]]`
5. All module references: `.zsh` -> `.sh`
   - `core/environment.zsh` -> `core/environment.sh`
   - `core/options.zsh` -> `core/options.sh`
   - `core/history.zsh` -> `core/history.sh`
   - `tools/nvm.zsh` -> `tools/nvm.sh`
   - `tools/conda.zsh` -> `tools/conda.sh`
   - `tools/system.zsh` -> `tools/system.sh`
   - `features/broadcast.zsh` -> `features/broadcast.sh`
   - `logging/session-tracker.zsh` -> `logging/session-tracker.sh`
   - `interactive/colors.zsh` -> `interactive/colors.sh`
   - `interactive/prompt.zsh` -> `interactive/prompt.sh`
   - `interactive/aliases.zsh` -> `interactive/aliases.sh`
   - `interactive/completion.zsh` -> `interactive/completion.sh`
   - `logging/replay-tools.zsh` -> `logging/replay-tools.sh`
   - `tools/fzf.zsh` -> `tools/fzf.sh`
6. Work secrets: `work.zsh` -> `work.sh`
7. Google Cloud SDK: `path.zsh.inc` -> `path.bash.inc`
8. Remove `unset -f source_module` (bash handles this fine, but can keep)
9. Debug echo lines: keep or convert emoji to text (bash handles UTF-8 fine)

Keep the original zshrc file - do not delete it.
  </action>
  <tests skip_tests="true">
    <skip_tests_reason>Entry point configuration - verified by bash -n</skip_tests_reason>
  </tests>
  <verify>bash -n bashrc && grep -q '#!/bin/bash' bashrc && grep -q 'environment.sh' bashrc</verify>
  <done>bashrc exists with bash shebang, sources .sh modules, passes bash -n</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `bash -n bashrc` - main entry point parses
2. `for f in core/*.sh interactive/*.sh logging/*.sh tools/nvm.sh tools/system.sh; do bash -n "$f"; done` - all converted files parse
3. No `setopt` or `[[ -o interactive ]]` in converted files
</verification>

<success_criteria>
- 11 new .sh files exist (or renamed via git mv)
- bashrc exists with proper bash syntax
- All files pass `bash -n` syntax check
- No zsh-specific constructs in converted files
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-syntax-conversion/01-01-SUMMARY.md`
</output>
