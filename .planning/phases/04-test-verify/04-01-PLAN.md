---
phase: 04-test-verify
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/test_suite.sh
  - tests/Dockerfile.test
  - tests/run_docker_tests.sh
autonomous: true
must_haves:
  truths:
    - "test_suite.sh sources bashrc not zshrc"
    - "test_suite.sh checks for .sh module files not .zsh"
    - "test_suite.sh uses bash not zsh for subshell tests"
    - "Dockerfile.test uses bash as default shell"
    - "Docker tests install and validate under bash"
  artifacts:
    - path: "tests/test_suite.sh"
      provides: "Bash-oriented test suite"
      contains: "bashrc"
    - path: "tests/Dockerfile.test"
      provides: "Docker test environment for bash"
      contains: "/bin/bash"
    - path: "tests/run_docker_tests.sh"
      provides: "Docker test runner"
  key_links:
    - from: "tests/test_suite.sh"
      to: "bashrc"
      via: "source ~/.thomcom_shell/bashrc"
      pattern: "source.*bashrc"
    - from: "tests/Dockerfile.test"
      to: "install.sh"
      via: "bash install.sh"
      pattern: "bash install.sh"
---

<objective>
Update test suite and Docker test infrastructure from zsh to bash.

Purpose: The existing test files still reference zshrc, .zsh modules, and use zsh subshells. They must be converted to test the bash configuration.
Output: Updated test_suite.sh, Dockerfile.test, run_docker_tests.sh
</objective>

<execution_context>
@/home/devkit/.claude/get-shit-done/workflows/execute-plan.md
@/home/devkit/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@tests/test_suite.sh
@tests/Dockerfile.test
@tests/run_docker_tests.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert test_suite.sh to test bash configuration</name>
  <files>tests/test_suite.sh</files>
  <action>
Update every test in test_suite.sh to reference bash instead of zsh:

1. Test 1 "Core files exist": Check for `~/.thomcom_shell/bashrc` instead of `zshrc`
2. Test 2 "CLAUDECODE compatibility": Use `bash -c 'CLAUDECODE=1 source ~/.bashrc'` instead of `zsh -c 'CLAUDECODE=1 source ~/.zshrc'`
3. Test 3 "Broadcast system": Same pattern - use bash and source bashrc (via ~/.bashrc which should link to it)
4. Test 4 "Environment variables": Same - bash subshell sourcing bashrc
5. Test 5 "FZF integration": Use bash subshell
6. Test 6 "Core modules exist": Check for `.sh` extensions instead of `.zsh` (core/environment.sh, tools/fzf.sh, features/broadcast.sh)

Keep the same test structure and output formatting. Keep all 6 tests.

Note: Tests 2-5 should source `~/.thomcom_shell/bashrc` directly (not `~/.bashrc`) since the symlink may not exist in test environments. Use `bash -c 'CLAUDECODE=1 source ~/.thomcom_shell/bashrc ...'`.
  </action>
  <verify>bash -n tests/test_suite.sh && grep -c 'zsh' tests/test_suite.sh (should be 0)</verify>
  <done>All tests reference bashrc and .sh modules, zero zsh references remain</done>
</task>

<task type="auto">
  <name>Task 2: Update Dockerfile.test for bash</name>
  <files>tests/Dockerfile.test, tests/run_docker_tests.sh</files>
  <action>
In Dockerfile.test:
1. Remove `zsh` from the apt-get install list (bash is already in ubuntu:24.04)
2. Change `CMD ["/bin/zsh", "-l"]` to `CMD ["/bin/bash", "-l"]`
3. Keep everything else the same (the install.sh run and test_suite.sh run are already using bash)

In run_docker_tests.sh:
- No functional changes needed (already uses bash), but verify no zsh references exist. If the interactive run hint says zsh, change to bash.
  </action>
  <verify>grep -c 'zsh' tests/Dockerfile.test tests/run_docker_tests.sh (should be 0 for both)</verify>
  <done>Docker test infrastructure references only bash, no zsh dependencies</done>
</task>

</tasks>

<verification>
- `bash -n tests/test_suite.sh` passes
- `bash -n tests/run_docker_tests.sh` passes
- `grep -r 'zsh\|\.zsh\|zshrc' tests/` returns no matches
</verification>

<success_criteria>
All three test files converted to bash. Zero zsh references in tests/ directory.
</success_criteria>

<output>
After completion, create `.planning/phases/04-test-verify/04-01-SUMMARY.md`
</output>
